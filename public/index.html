<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äºŒæ¬¡å…ƒè¯„è®ºå¢™</title>
  <style>
    /* å…¨å±€æ ·å¼é‡ç½® + äºŒæ¬¡å…ƒé£æ ¼åŸºç¡€é…ç½® */
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
    }
    
    /* äºŒæ¬¡å…ƒèƒŒæ™¯å›¾ï¼ˆè‡ªé€‚åº”ã€ä¸é‡å¤ã€å›ºå®šï¼‰ */
    body {
      background: url('https://pic1.zhimg.com/v2-899e9d789c6948f08f90e8b3997c4885_r.jpg?source=1940ef5c') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      padding: 20px;
      position: relative;
    }
    
    /* èƒŒæ™¯åŠé€æ˜é®ç½©ï¼ˆä¿è¯æ–‡å­—å¯è¯»æ€§ï¼‰ */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.85); /* ç™½è‰²åŠé€æ˜é®ç½©ï¼Œå¯è°ƒæ•´é€æ˜åº¦ */
      z-index: -1;
    }
    
    /* é¡µé¢å®¹å™¨ï¼ˆå±…ä¸­ã€æœ€å¤§å®½åº¦ã€é˜´å½±ï¼‰ */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 10px;
    }
    
    /* æ ‡é¢˜æ ·å¼ï¼ˆäºŒæ¬¡å…ƒæ¸å˜æ–‡å­—ï¼‰ */
    .page-title {
      text-align: center;
      margin: 30px 0;
      font-size: 32px;
      font-weight: bold;
      background: linear-gradient(90deg, #ff69b4, #8a2be2, #00bfff);
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* è¯„è®ºè¡¨å•æ ·å¼ï¼ˆå¡ç‰‡åŒ–ã€åœ†è§’ã€é˜´å½±ï¼‰ */
    .comment-form {
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      margin-bottom: 40px;
      border: 1px solid #f0f0f0;
    }
    
    .comment-form h3 {
      color: #333;
      margin-bottom: 20px;
      font-size: 20px;
      border-left: 4px solid #ff69b4;
      padding-left: 10px;
    }
    
    /* è¾“å…¥æ¡†æ ·å¼ï¼ˆäºŒæ¬¡å…ƒé£æ ¼åœ†è§’ã€æ¸å˜è¾¹æ¡†ï¼‰ */
    .comment-form input, 
    .comment-form textarea {
      width: 100%;
      padding: 12px 15px;
      margin: 12px 0;
      border: 2px solid #eee;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }
    
    .comment-form input:focus, 
    .comment-form textarea:focus {
      outline: none;
      border-color: #8a2be2;
      box-shadow: 0 0 8px rgba(138, 43, 226, 0.2);
    }
    
    .comment-form textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.6;
    }
    
    /* æäº¤æŒ‰é’®ï¼ˆäºŒæ¬¡å…ƒæ¸å˜ã€hoveråŠ¨æ•ˆï¼‰ */
    .submit-btn {
      padding: 12px 30px;
      background: linear-gradient(90deg, #ff69b4, #8a2be2);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      margin-top: 10px;
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
    }
    
    /* è¯„è®ºåˆ—è¡¨æ ‡é¢˜ */
    .comment-list-title {
      font-size: 18px;
      color: #333;
      margin-bottom: 20px;
      font-weight: bold;
    }
    
    /* è¯„è®ºé¡¹æ ·å¼ï¼ˆäºŒæ¬¡å…ƒå¡ç‰‡ã€hoveråŠ¨æ•ˆï¼‰ */
    .comment-item {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 15px;
      transition: all 0.3s ease;
      border-left: 4px solid #00bfff;
    }
    
    .comment-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    }
    
    /* è¯„è®ºä½œè€…+æ—¶é—´æ ·å¼ */
    .comment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .author {
      font-weight: bold;
      color: #8a2be2;
      font-size: 16px;
    }
    
    .time {
      color: #999;
      font-size: 14px;
    }
    
    /* è¯„è®ºå†…å®¹æ ·å¼ */
    .comment-content {
      color: #555;
      line-height: 1.8;
      font-size: 15px;
      padding-top: 10px;
      border-top: 1px dashed #eee;
    }
    
    /* ç©ºè¯„è®ºæç¤º */
    .empty-tip {
      text-align: center;
      color: #999;
      font-size: 16px;
      padding: 40px 0;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    /* åŠ è½½æç¤º */
    .loading-tip {
      text-align: center;
      color: #666;
      font-size: 16px;
      padding: 20px 0;
    }
    
    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
      .page-title {
        font-size: 26px;
      }
      .comment-form {
        padding: 20px;
      }
      .comment-item {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <h1 class="page-title">âœ¨ äºŒæ¬¡å…ƒè¯„è®ºå¢™ âœ¨</h1>

    <!-- è¯„è®ºæäº¤è¡¨å• -->
    <div class="comment-form">
      <h3>ğŸ’¬ å‘è¡¨ä½ çš„è¯„è®º</h3>
      <input type="text" id="author" placeholder="ä½ çš„æ˜µç§°ï¼ˆå¯é€‰ï¼‰">
      <textarea id="content" placeholder="è¯·è¾“å…¥æƒ³åˆ†äº«çš„å†…å®¹..."></textarea>
      <button class="submit-btn" onclick="submitComment()">æäº¤è¯„è®º</button>
    </div>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <div class="comment-list">
      <h3 class="comment-list-title">ğŸ“ è¯„è®ºåˆ—è¡¨</h3>
      <div id="commentList" class="loading-tip">åŠ è½½è¯„è®ºä¸­...</div>
    </div>
  </div>

  <script>
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–è¯„è®º
    window.onload = loadComments;

    // æäº¤è¯„è®ºï¼ˆä¿ç•™åŸæœ‰APIé€»è¾‘ï¼‰
    async function submitComment() {
      const author = document.getElementById('author').value.trim() || 'åŒ¿åå°å¯çˆ±';
      const content = document.getElementById('content').value.trim();

      // å†…å®¹æ ¡éªŒ
      if (!content) {
        alert('ğŸ’¡ è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©ºå“¦ï½');
        return;
      }

      try {
        const res = await fetch('/api/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ author, content })
        });
        const data = await res.json();

        if (data.success) {
          alert('ğŸ‰ è¯„è®ºæäº¤æˆåŠŸå•¦ï¼');
          document.getElementById('content').value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
          loadComments(); // åˆ·æ–°è¯„è®ºåˆ—è¡¨
        } else {
          alert('ğŸ˜¥ æäº¤å¤±è´¥ï¼š' + data.message);
        }
      } catch (error) {
        alert('ğŸŒ ç½‘ç»œå‡ºé”™å•¦ï¼Œè¯·ç¨åå†è¯•ï½');
        console.error('æäº¤å¤±è´¥ï¼š', error);
      }
    }

    // è·å–å¹¶æ¸²æŸ“è¯„è®ºï¼ˆä¿ç•™åŸæœ‰APIé€»è¾‘ï¼‰
    async function loadComments() {
      const commentList = document.getElementById('commentList');
      try {
        const res = await fetch('/api/posts');
        const comments = await res.json();

        // æ¸²æŸ“è¯„è®º
        if (!comments || comments.length === 0) {
          commentList.innerHTML = '<div class="empty-tip">ğŸƒ è¿˜æ²¡æœ‰è¯„è®ºå“¦ï¼Œå¿«æ¥æŠ¢æ²™å‘ï½</div>';
          return;
        }

        commentList.innerHTML = comments.map(comment => `
          <div class="comment-item">
            <div class="comment-header">
              <span class="author">${comment.author}</span>
              <span class="time">${formatTime(comment.created_at)}</span>
            </div>
            <div class="comment-content">${comment.content}</div>
          </div>
        `).join('');
      } catch (error) {
        commentList.innerHTML = '<div class="empty-tip">âŒ åŠ è½½è¯„è®ºå¤±è´¥ï¼Œåˆ·æ–°é¡µé¢è¯•è¯•å§ï½</div>';
        console.error('åŠ è½½è¯„è®ºå¤±è´¥ï¼š', error);
      }
    }

    // æ—¶é—´æ ¼å¼åŒ–
    function formatTime(timeStr) {
      return new Date(timeStr).toLocaleString('zh-CN', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
  </script>
</body>
</html>