<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>360Â° å…¨æ™¯å›¾ç‰‡æŸ¥çœ‹å™¨ï¼ˆæœ¬åœ°ä¸Šä¼ /æ‹–æ‹½/ç²˜è´´ï¼‰</title>
  <link rel="stylesheet" href="https://unpkg.com/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.css" />
  <style>
    :root { --bg:#0b1020; --panel:#12172a; --text:#e7ecff; --muted:#94a3b8; }
    html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"PingFang SC","Noto Sans CJK SC","Microsoft Yahei",sans-serif}
    .app{display:flex; flex-direction:column; height:100%}
    header{display:flex; flex-wrap:wrap; gap:.5rem; align-items:center; padding:.75rem 1rem; background:linear-gradient(180deg,#0d1328,#0b1020); border-bottom:1px solid #1c2445}
    header .title{font-size:1rem; font-weight:700; letter-spacing:.5px; margin-right:auto}
    .btn{appearance:none; border:1px solid #243056; background:var(--panel); color:var(--text); padding:.5rem .75rem; border-radius:.75rem; cursor:pointer; font-weight:600}
    .btn:hover{border-color:#3a4a7a}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    /* éšè— file inputï¼Œä½†ä¿ç•™äº¤äº’ */
    #file{position:absolute; left:-9999px;}
    .viewer-wrap{position:relative; flex:1; min-height:220px}
    #viewer{position:absolute; inset:0}
    .dropzone{position:absolute; inset:0; display:none; align-items:center; justify-content:center; backdrop-filter:blur(2px); background:rgba(23,31,60,.55); border:2px dashed #5674ff; color:#cbd5e1; text-align:center; padding:1rem; z-index:10}
    .dropzone.active{display:flex}
    .tips{font-size:.9rem; color:var(--muted); padding:.5rem 1rem; border-top:1px solid #1c2445; background:#0b1020}
    .tips kbd{padding:.15rem .35rem; border:1px solid #324172; border-bottom-width:2px; border-radius:.4rem; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background:#0f1733; color:#e2e8f0}
    .toast{position:fixed; right:12px; bottom:12px; background:#101735; border:1px solid #253363; color:#e5edff; padding:.6rem .8rem; border-radius:.6rem; font-size:.9rem; box-shadow:0 6px 20px rgba(0,0,0,.25); z-index:20; display:none}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">ğŸŒ€ 360Â° å…¨æ™¯å›¾ç‰‡æŸ¥çœ‹å™¨</div>
      <button class="btn" id="open">æ‰“å¼€å›¾ç‰‡</button>
      <input id="file" type="file" accept="image/*" />
      <button class="btn" id="sample">è½½å…¥ç¤ºä¾‹</button>
      <button class="btn" id="autorotate">è‡ªåŠ¨æ—‹è½¬</button>
      <button class="btn" id="reset">é‡ç½®è§†è§’</button>
      <button class="btn" id="fullscreen">å…¨å±</button>
    </header>

    <div class="viewer-wrap" id="wrap">
      <div id="viewer"></div>
      <div class="dropzone" id="drop">
        <div>
          <div style="font-size:1.15rem; font-weight:700; margin-bottom:.25rem">å°†å›¾ç‰‡æ‹–æ‹½åˆ°æ­¤å¤„</div>
          <div>æ”¯æŒ <b>equirectangular</b>ï¼ˆç­‰è·é•¿æ–¹ï¼‰å…¨æ™¯å›¾ï¼›ä¹Ÿå¯ <kbd>Ctrl</kbd>+<kbd>V</kbd> ç›´æ¥ç²˜è´´</div>
        </div>
      </div>
    </div>

    <div class="tips">
      ç”¨æ³•ï¼šç‚¹å‡»â€œæ‰“å¼€å›¾ç‰‡â€é€‰æ‹©æœ¬åœ°æ–‡ä»¶ï¼Œæˆ–ç›´æ¥æ‹–æ‹½ / ç²˜è´´åˆ°é¡µé¢ã€‚æ»šè½®ç¼©æ”¾ï¼Œæ‹–åŠ¨æ—‹è½¬ã€‚ç§»åŠ¨ç«¯æ”¯æŒåŒæŒ‡ç¼©æ”¾ä¸ï¼ˆHTTPS ä¸‹ï¼‰é™€èºä»ªã€‚<br>
      æ³¨æ„ï¼šå¿…é¡»æ˜¯ <b>360Ã—180 ç­‰è·é•¿æ–¹æŠ•å½±</b> å…¨æ™¯å›¾ï¼Œæ™®é€šå›¾ç‰‡ä¼šå˜å½¢ã€‚
    </div>
  </div>

  <script src="https://unpkg.com/three@0.147.0/build/three.min.js"></script>
  <script src="https://unpkg.com/uevent/browser.min.js"></script>
  <script src="https://unpkg.com/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.js"></script>

  <script>
    const SAMPLE_SRC = 'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/2294472375_24a3b8ef46_o.jpg';
    const SAMPLE_CAPTION = 'Three.js ç¤ºä¾‹å…¨æ™¯å›¾';

    const viewer = new PhotoSphereViewer.Viewer({
      container: document.getElementById('viewer'),
      panorama: SAMPLE_SRC,
      caption: SAMPLE_CAPTION,
      touchmoveTwoFingers: true,
      mousewheelCtrlKey: false,
      navbar: ['zoom', 'move', 'caption', 'fullscreen']
    });

    const openBtn = document.getElementById('open');
    const fileInput = document.getElementById('file');
    const sampleBtn = document.getElementById('sample');
    const autoBtn = document.getElementById('autorotate');
    const resetBtn = document.getElementById('reset');
    const fsBtn = document.getElementById('fullscreen');
    const wrapEl = document.getElementById('wrap');
    const dropEl = document.getElementById('drop');

    let isAutoRotating = false;

    openBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', async (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      loadFileAsPanorama(file);
      e.target.value = '';
    });

    sampleBtn.addEventListener('click', () => {
      viewer.setPanorama(SAMPLE_SRC, { caption: SAMPLE_CAPTION });
      toast('å·²è½½å…¥ç¤ºä¾‹å…¨æ™¯');
    });

    autoBtn.addEventListener('click', () => {
      isAutoRotating = !isAutoRotating;
      viewer.toggleAutorotate(isAutoRotating);
      autoBtn.textContent = isAutoRotating ? 'åœæ­¢æ—‹è½¬' : 'è‡ªåŠ¨æ—‹è½¬';
    });

    resetBtn.addEventListener('click', () => {
      viewer.rotate({ yaw: 0, pitch: 0 });
      viewer.zoom(50);
    });

    fsBtn.addEventListener('click', () => viewer.enterFullscreen());

    ;['dragenter','dragover'].forEach(ev => wrapEl.addEventListener(ev, (e)=>{
      e.preventDefault();
      dropEl.classList.add('active');
    }));
    ;['dragleave','drop'].forEach(ev => wrapEl.addEventListener(ev, (e)=>{
      e.preventDefault();
      if (ev === 'drop') {
        const file = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
        if (file) loadFileAsPanorama(file);
      }
      dropEl.classList.remove('active');
    }));

    window.addEventListener('paste', (e) => {
      const items = e.clipboardData && e.clipboardData.items;
      if (!items) return;
      for (const it of items) {
        if (it.kind === 'file') {
          const file = it.getAsFile();
          if (file && file.type.startsWith('image/')) {
            loadFileAsPanorama(file);
            break;
          }
        }
      }
    });

    async function loadFileAsPanorama(file){
      if (!file.type.startsWith('image/')) {
        toast('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
        return;
      }
      const url = URL.createObjectURL(file);
      try {
        await viewer.setPanorama(url, { caption: file.name });
        toast('å·²åŠ è½½ï¼š' + file.name);
      } catch (err) {
        console.error(err);
        toast('åŠ è½½å¤±è´¥ï¼šè¯¥å›¾ç‰‡å¯èƒ½ä¸æ˜¯ 360Ã—180 å…¨æ™¯');
      } finally {
        requestAnimationFrame(()=> URL.revokeObjectURL(url));
      }
    }

    const toastEl = document.createElement('div');
    toastEl.className = 'toast';
    document.body.appendChild(toastEl);
    let toastTimer = null;
    function toast(msg){
      toastEl.textContent = msg;
      toastEl.style.display = 'block';
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toastEl.style.display = 'none', 2200);
    }
  </script>
</body>
</html>
